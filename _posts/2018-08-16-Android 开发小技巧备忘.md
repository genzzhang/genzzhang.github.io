---
layout: post
title: Android 开发小技巧备忘【性能】
date: 2018-08-16 21:30
categories: Android
tags: 技巧
---


## 1、动态dump   
### 1) Native C++版本
```   
#include <utils/CallStack.h>然后使用CallStack类
```  
### 2) Java版本
```   
Exception e = new Exception("dumpinfo");  
e.printStackTrace()
```   
<br />
## 2、卡顿   
### 1) adb shell dumpsys
```  
adb shell dumpsys SurfaceFlinger
adb shell dumpsys gfxinfo 
```  
### 2) 利用UI线程的Looper打印的日志
```   
Looper.loop()中，dispatchMessage前后会打印日志
Looper.getMainLooper().setMessageLogging(new Printer())
打印UI线程的堆栈信息
  StringBuilder sb = new StringBuilder();
  StackTraceElement[] stackTrace = Looper.getMainLooper().getThread().getStackTrace();
  for (StackTraceElement s : stackTrace) {
      sb.append(s.toString() + "\n");
  }
  Log.e("TAG", sb.toString());
``` 
### 3) 利用Choreographer.FrameCallback监控卡顿
```   
Choreographer.getInstance().postFrameCallback(new Choreographer.FrameCallback())
Android系统每隔16ms发出VSYNC信号，来通知界面进行重绘、渲染，
每一次同步的周期为16.6ms，代表一帧的刷新频率。
当每一帧被渲染时会触发回调FrameCallback，
FrameCallback回调doFrame(long frameTimeNanos)函数。
```
<br /> 